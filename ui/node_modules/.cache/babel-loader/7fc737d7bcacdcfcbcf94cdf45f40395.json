{"ast":null,"code":"import _regeneratorRuntime from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _taggedTemplateLiteral from \"/Users/martinbrandt/martin-brandt/calorie-counter/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/Users/martinbrandt/martin-brandt/calorie-counter/src/pages/CalorieLogger.jsx\";\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    border:none;\\n    height:30px;\\n    font-size: 14px;\\n    margin: 5px;\\n    padding:5px;\\n    text-align: center;\\n    background-color: \", \"\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  background-color: \", \";\\n  height: 60px;\\n  display:flex;\\n  flex-direction:row;\\n  margin: 30px;\\n  align-items: center;\\n  justify-content: center\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  background-color: \", \";\\n  height: calc(100vh - \", \" - 70px) ;\\n  margin: 30px 30px 0 30px;\\n  padding: 20px;\\n  overflow: auto;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from 'react';\nimport Header from 'components/Header';\nimport Table from 'components/Table';\nimport styled from 'styled-components';\nimport { lightGreen } from 'variables';\nimport { loadUserMeals, deleteMeal, loadUser, saveNewMeal, updateMeal, updateUser } from 'Api';\nimport { append, prepend, without, equals, isEmpty, contains, assoc, filter, complement, concat, set, lensPath, keys, propEq, groupBy, prop } from 'ramda';\nimport Button from 'components/Button';\nimport TableItemGroup from 'components/TableItemGroup';\nimport moment from 'moment';\nimport Filter from 'components/Filter';\nimport { headerHeight, inputGreen } from 'variables';\nvar Body = styled.div(_templateObject(), lightGreen, headerHeight);\nvar ControlPanel = styled.div(_templateObject2(), lightGreen);\nvar StyledInput = styled.input(_templateObject3(), inputGreen);\nvar initialFilterState = {\n  startTime: '00:00:00',\n  endTime: '23:59:59',\n  startDate: '1900-01-01',\n  endDate: '2090-01-01'\n};\nvar isNotEmpty = complement(isEmpty);\nvar dateConstant = 'YYYY-MM-DD HH:mm:ss';\n\nvar convertStringToMoment = function convertStringToMoment(date) {\n  return moment(date, dateConstant).utc();\n};\n\nvar getMealMoment = function getMealMoment(meal) {\n  return convertStringToMoment(prop('created_dt', meal));\n};\n\nvar initialState = {\n  meals: [],\n  editingItems: [],\n  filter: initialFilterState,\n  user: {}\n};\n\nvar CalorieLogger =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CalorieLogger, _Component);\n\n  function CalorieLogger() {\n    var _this;\n\n    _classCallCheck(this, CalorieLogger);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CalorieLogger).call(this));\n\n    _this.setFilter = function (filters) {\n      _this.setState(function (prevState) {\n        return set(lensPath(['filter']), filters, prevState);\n      });\n    };\n\n    _this.clearFilter = function (cb) {\n      _this.setFilter(initialFilterState);\n\n      cb();\n    };\n\n    _this.filterMeals = function (meals) {\n      var filter = _this.state.filter;\n      var startDateTimeString = concat(concat(filter.startDate, ' '), filter.startTime);\n      var endDateTimeString = concat(concat(filter.endDate, ' '), filter.endTime); // extracts the start and end date/time of the filter and creates a moment for each\n\n      var startDateTime = convertStringToMoment(startDateTimeString);\n      var endDateTime = convertStringToMoment(endDateTimeString); // checks to see if the meal should show based on the filter\n\n      var isInRange = function isInRange(dateTimeMoment) {\n        return startDateTime.isBefore(dateTimeMoment) && endDateTime.isAfter(dateTimeMoment);\n      };\n\n      return meals.filter(function (meal) {\n        return isInRange(getMealMoment(meal));\n      });\n    };\n\n    _this.toggleEditing = function (id) {\n      contains(id, _this.state.editingItems) ? _this.setState(function (prevState) {\n        return {\n          editingItems: without(id, prevState.editingItems)\n        };\n      }) : _this.setState(function (prevState) {\n        return {\n          editingItems: prepend(id, prevState.editingItems)\n        };\n      });\n    };\n\n    _this.loadInitialState =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(cachedUser) {\n        var loadedUser, meals;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return loadUser(cachedUser.id);\n\n              case 3:\n                loadedUser = _context.sent;\n                _context.next = 6;\n                return loadUserMeals();\n\n              case 6:\n                meals = _context.sent;\n\n                _this.setState({\n                  user: loadedUser,\n                  meals: meals\n                });\n\n                _context.next = 13;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](0);\n\n                if (_context.t0.message === 'Expired Token') {\n                  _this.setState({\n                    user: {}\n                  });\n                }\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 10]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.getMeals =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var meals;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return loadUserMeals();\n\n            case 2:\n              meals = _context2.sent;\n\n              _this.setState({\n                meals: meals\n              });\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    _this.logout = function () {\n      sessionStorage.clear();\n\n      _this.setState(initialState);\n    };\n\n    _this.saveMeal =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(meal) {\n        var newMeal;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return saveNewMeal(meal);\n\n              case 3:\n                newMeal = _context3.sent;\n\n                _this.addNewMealToState(newMeal);\n\n                _context3.next = 10;\n                break;\n\n              case 7:\n                _context3.prev = 7;\n                _context3.t0 = _context3[\"catch\"](0);\n\n                _this.addNewMealToState(assoc('error', _context3.t0.message, meal));\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[0, 7]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.updateMeal =\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(mealId, meal) {\n        var updatedMeal;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return updateMeal(mealId, meal);\n\n              case 3:\n                updatedMeal = _context4.sent;\n\n                _this.replaceExistingMealInState(updatedMeal);\n\n                _context4.next = 10;\n                break;\n\n              case 7:\n                _context4.prev = 7;\n                _context4.t0 = _context4[\"catch\"](0);\n\n                _this.replaceExistingMealInState(assoc('error', _context4.t0.message, meal));\n\n              case 10:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[0, 7]]);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    _this.addNewMealToState = function (newMeal) {\n      return _this.setState(function (prevState) {\n        return {\n          meals: append(newMeal, prevState.meals.filter(complement(propEq)('id', 0)))\n        };\n      });\n    };\n\n    _this.replaceExistingMealInState = function (existingMeal) {\n      return _this.setState(function (prevState) {\n        return {\n          meals: append(existingMeal, prevState.meals.filter(complement(propEq)('id', existingMeal.id)))\n        };\n      });\n    };\n\n    _this.deleteMeal =\n    /*#__PURE__*/\n    function () {\n      var _ref5 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(meal) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!meal.id) {\n                  _context5.next = 3;\n                  break;\n                }\n\n                _context5.next = 3;\n                return deleteMeal(meal.id);\n\n              case 3:\n                //remove meal from state\n                _this.setState(function (prevState) {\n                  return {\n                    meals: filter(complement(propEq)('id', meal.id), prevState.meals)\n                  };\n                });\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function (_x5) {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n\n    _this.setLoggedIn = function (user) {\n      return _this.setState({\n        user: user\n      });\n    };\n\n    _this.addNewMeal = function () {\n      _this.setState(function (prevState) {\n        return {\n          meals: append({\n            \"id\": 0,\n            \"created_dt\": moment().utc().format(dateConstant)\n          }, prevState.meals.filter(complement(propEq)('id', 0)))\n        };\n      });\n\n      _this.toggleEditing(\"item-0\");\n    };\n\n    _this.state = initialState;\n    return _this;\n  }\n\n  _createClass(CalorieLogger, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var cachedUser = JSON.parse(sessionStorage.getItem('user'));\n\n      if (cachedUser) {\n        this.setState({\n          user: cachedUser\n        });\n        this.loadInitialState(cachedUser);\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (isNotEmpty(this.state.user) && !equals(prevState.user, this.state.user)) {\n        console.log(prevState.user, this.state.user); //load the meals\n\n        this.getMeals();\n      }\n    } // sets the state of the item filter\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          meals = _this$state.meals,\n          editingItems = _this$state.editingItems,\n          filter = _this$state.filter,\n          user = _this$state.user;\n\n      var getDay = function getDay(date) {\n        return moment(date, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD');\n      };\n\n      var dayGroups = groupBy(function (meal) {\n        return getDay(prop('created_dt', meal));\n      })(this.filterMeals(meals));\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, React.createElement(Header, {\n        logout: this.logout,\n        toggleSignUp: this.props.toggleSignUp,\n        setUserLoggedIn: this.setLoggedIn,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205\n        },\n        __self: this\n      }), React.createElement(Body, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, \"User Meals:\"), React.createElement(ControlPanel, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, \"Daily Calorie Intake: \"), React.createElement(StyledInput, {\n        value: user.daily_calorie_count,\n        onChange: function onChange(_ref6) {\n          var target = _ref6.target;\n          return _this2.setState(function (prevState) {\n            return {\n              user: set(lensPath(['daily_calorie_count']), target.value, prevState.user)\n            };\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }), React.createElement(Button, {\n        inverse: true,\n        value: \"Set Calories\",\n        onClick:\n        /*#__PURE__*/\n        _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee6() {\n          var updatedUser;\n          return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  _context6.next = 2;\n                  return updateUser(user.id, {\n                    daily_calorie_count: parseInt(_this2.state.user.daily_calorie_count)\n                  });\n\n                case 2:\n                  updatedUser = _context6.sent;\n\n                  _this2.setState({\n                    user: updatedUser\n                  });\n\n                case 4:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }, _callee6);\n        })),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }), React.createElement(Button, {\n        inverse: true,\n        value: \"add meal\",\n        onClick: this.addNewMeal,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      })), React.createElement(Filter, {\n        clearFilter: this.clearFilter,\n        filter: filter,\n        setFilter: this.setFilter,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }), React.createElement(Table, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, keys(dayGroups).map(function (date, idx) {\n        return React.createElement(TableItemGroup, {\n          key: \"group-\".concat(idx),\n          calorieMax: user.daily_calorie_count,\n          day: date,\n          meals: dayGroups[date],\n          toggleEditing: _this2.toggleEditing,\n          editingItems: editingItems,\n          idx: idx,\n          saveMeal: _this2.saveMeal,\n          updateMeal: _this2.updateMeal,\n          deleteMeal: _this2.deleteMeal,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 226\n          },\n          __self: this\n        });\n      }))));\n    }\n  }]);\n\n  return CalorieLogger;\n}(Component);\n\nexport default CalorieLogger;","map":{"version":3,"sources":["/Users/martinbrandt/martin-brandt/calorie-counter/src/pages/CalorieLogger.jsx"],"names":["React","Component","Header","Table","styled","lightGreen","loadUserMeals","deleteMeal","loadUser","saveNewMeal","updateMeal","updateUser","append","prepend","without","equals","isEmpty","contains","assoc","filter","complement","concat","set","lensPath","keys","propEq","groupBy","prop","Button","TableItemGroup","moment","Filter","headerHeight","inputGreen","Body","div","ControlPanel","StyledInput","input","initialFilterState","startTime","endTime","startDate","endDate","isNotEmpty","dateConstant","convertStringToMoment","date","utc","getMealMoment","meal","initialState","meals","editingItems","user","CalorieLogger","setFilter","filters","setState","prevState","clearFilter","cb","filterMeals","state","startDateTimeString","endDateTimeString","startDateTime","endDateTime","isInRange","dateTimeMoment","isBefore","isAfter","toggleEditing","id","loadInitialState","cachedUser","loadedUser","message","getMeals","logout","sessionStorage","clear","saveMeal","newMeal","addNewMealToState","mealId","updatedMeal","replaceExistingMealInState","existingMeal","setLoggedIn","addNewMeal","format","JSON","parse","getItem","prevProps","console","log","getDay","dayGroups","props","toggleSignUp","daily_calorie_count","target","value","parseInt","updatedUser","map","idx"],"mappings":"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","sourcesContent":["import React, {Component,} from 'react';\nimport Header from 'components/Header';\nimport Table from 'components/Table';\nimport styled from 'styled-components';\nimport {lightGreen} from 'variables';\nimport {loadUserMeals, deleteMeal, loadUser, saveNewMeal, updateMeal, updateUser} from 'Api';\nimport {append, prepend, without, equals, isEmpty, contains, assoc, filter, complement, concat, set, lensPath, keys, propEq, groupBy, prop} from 'ramda';\nimport Button from 'components/Button';\nimport TableItemGroup from 'components/TableItemGroup';\nimport moment from 'moment';\nimport Filter from 'components/Filter';\nimport {headerHeight, inputGreen} from 'variables';\n\nconst Body = styled.div`\n  background-color: ${lightGreen};\n  height: calc(100vh - ${headerHeight} - 70px) ;\n  margin: 30px 30px 0 30px;\n  padding: 20px;\n  overflow: auto;\n`;\n\nconst ControlPanel = styled.div`\n  background-color: ${lightGreen};\n  height: 60px;\n  display:flex;\n  flex-direction:row;\n  margin: 30px;\n  align-items: center;\n  justify-content: center\n`;\n\nconst StyledInput = styled.input`\n    border:none;\n    height:30px;\n    font-size: 14px;\n    margin: 5px;\n    padding:5px;\n    text-align: center;\n    background-color: ${inputGreen}\n`\n\nconst initialFilterState = {\n    startTime: '00:00:00',\n    endTime: '23:59:59',\n    startDate: '1900-01-01',\n    endDate: '2090-01-01'\n}\n\nconst isNotEmpty = complement(isEmpty)\n\nconst dateConstant = 'YYYY-MM-DD HH:mm:ss'\n\nconst convertStringToMoment = date => moment(date, dateConstant).utc()\n\nconst getMealMoment = meal => convertStringToMoment(prop('created_dt', meal))\n\nconst initialState = {\n    meals:[],\n    editingItems: [],\n    filter: initialFilterState,\n    user: {},\n};\n\nclass CalorieLogger extends Component {\n    constructor() {\n        super();\n        this.state = initialState;\n    }\n\n    componentDidMount(){\n        const cachedUser = JSON.parse(sessionStorage.getItem('user'));\n        if(cachedUser){\n            this.setState({user: cachedUser})\n            this.loadInitialState(cachedUser);\n        }\n    }\n\n    componentDidUpdate(prevProps, prevState){\n        if(isNotEmpty(this.state.user) && !equals(prevState.user, this.state.user)){\n            console.log(prevState.user, this.state.user)\n            //load the meals\n            this.getMeals();\n            \n        }\n    }\n\n    // sets the state of the item filter\n    setFilter = filters => {\n        this.setState(prevState => set(lensPath(['filter']), filters, prevState))\n    }\n\n    // resets the state of the item filter\n    clearFilter = cb => {\n        this.setFilter(initialFilterState)\n        cb();\n    }\n\n    // executes on click of the \"filter\" button, filters the meals in state that are sent down the tree\n    filterMeals = meals => {\n        const {filter} = this.state;\n        const startDateTimeString = concat(concat(filter.startDate,' '), filter.startTime);\n        const endDateTimeString = concat(concat(filter.endDate,' '), filter.endTime);\n\n        // extracts the start and end date/time of the filter and creates a moment for each\n        const startDateTime = convertStringToMoment(startDateTimeString);\n        const endDateTime = convertStringToMoment(endDateTimeString);\n        \n        // checks to see if the meal should show based on the filter\n        const isInRange = dateTimeMoment => startDateTime.isBefore(dateTimeMoment) && endDateTime.isAfter(dateTimeMoment)\n        \n        return meals.filter(meal => isInRange(getMealMoment(meal)));\n\n    }  \n    // toggles the list item editing state based on its ID\n    toggleEditing = id => {\n        contains(id, this.state.editingItems) ? \n        this.setState(prevState => ({editingItems: without(id, prevState.editingItems)})) :\n        this.setState(prevState => ({editingItems: prepend(id, prevState.editingItems)}))\n    }\n\n    // sets up the initial state, called when component mounts\n    // loads newest version of cached user\n    loadInitialState = async cachedUser => {\n        try {\n            const loadedUser = await loadUser(cachedUser.id);\n            const meals = await loadUserMeals();\n\n            this.setState({user: loadedUser, meals: meals});\n        } catch (err){\n            if(err.message === 'Expired Token'){\n                this.setState({user: {}})\n            }\n        }\n    }\n\n    // retrieves the user's meals and sets the state\n    getMeals = async () => {\n        const meals = await loadUserMeals();\n        this.setState({meals: meals});\n    }\n\n    // clears the user from the session and resets state to an empty user\n    logout = () => {\n        sessionStorage.clear();\n        this.setState(initialState)\n    }\n\n    // saves a new user meal, and adds the new meal to the state\n    saveMeal = async meal => {\n        try {\n            const newMeal = await saveNewMeal(meal);\n            this.addNewMealToState(newMeal)\n        } catch(err){\n            this.addNewMealToState(assoc('error', err.message, meal))\n        }\n        \n    }\n\n    // updates a user meal and replaces meal with updated meal in state\n    updateMeal = async (mealId, meal) => {\n        try {\n            const updatedMeal = await updateMeal(mealId, meal);\n            this.replaceExistingMealInState(updatedMeal)\n        } catch(err){\n            this.replaceExistingMealInState(assoc('error', err.message, meal))\n        }\n    }\n    // util function to add a new meal, and remove new meal stub from state\n    addNewMealToState = newMeal => this.setState(prevState => ({\n        meals: append(newMeal, prevState.meals.filter(complement(propEq)('id', 0)))\n    }))\n\n    // util function to filter out existing meal and add the updated version to state\n    replaceExistingMealInState = existingMeal => this.setState(prevState => ({\n        meals: append(existingMeal, prevState.meals.filter(complement(propEq)('id', existingMeal.id)))\n    }))\n\n    // deletes the meal and removes it from the state\n    deleteMeal = async meal => {\n        if(meal.id) {\n            await deleteMeal(meal.id)\n        }\n        //remove meal from state\n        this.setState(prevState => ({meals: filter(complement(propEq)('id', meal.id), prevState.meals)}));\n    }\n\n    // sets the user in state on login\n    setLoggedIn = user => this.setState({user:user});\n\n    // adds a new meal stub to the state, only allows one meal to be added at a time\n    addNewMeal= () => {\n        this.setState(prevState => ({meals: append({\"id\":0, \"created_dt\": moment().utc().format(dateConstant)}, prevState.meals.filter(complement(propEq)('id', 0)))}));\n        this.toggleEditing(\"item-0\");\n    }\n\n\n    render(){\n        const {meals, editingItems, filter, user} = this.state;\n\n        const getDay = date => moment(date, 'YYYY-MM-DD HH:mm:ss').format('YYYY-MM-DD')\n\n        const dayGroups = groupBy(meal => getDay(prop('created_dt', meal)))(this.filterMeals(meals));\n        \n        return <div>\n                    <Header logout={this.logout} toggleSignUp={this.props.toggleSignUp} setUserLoggedIn={this.setLoggedIn}/>\n                    <Body>\n                        <h3>User Meals:</h3>\n                        <ControlPanel>\n                            <label>Daily Calorie Intake: </label>\n                            <StyledInput \n                                value={user.daily_calorie_count} \n                                onChange={({target}) => \n                                    this.setState(prevState => ({user: set(lensPath(['daily_calorie_count']), target.value, prevState.user)}))\n                                }\n                            />\n                            <Button inverse value='Set Calories' onClick={async () => {\n                                        const updatedUser = await updateUser(user.id, {daily_calorie_count: parseInt(this.state.user.daily_calorie_count)});\n                                        this.setState({user: updatedUser});\n                                    }\n                                }/>\n                            <Button inverse value='add meal' onClick={this.addNewMeal}/>\n                        </ControlPanel>\n\n                        <Filter clearFilter={this.clearFilter} filter={filter} setFilter={this.setFilter}/>\n                        <Table >{keys(dayGroups).map((date, idx) => \n                            <TableItemGroup \n                                key={`group-${idx}`}\n                                calorieMax={user.daily_calorie_count}\n                                day={date}\n                                meals={dayGroups[date]}\n                                toggleEditing={this.toggleEditing}\n                                editingItems={editingItems} \n                                idx={idx}\n                                saveMeal={this.saveMeal}\n                                updateMeal={this.updateMeal}\n                                deleteMeal={this.deleteMeal}\n                            />\n                        )}</Table>\n        \n                    </Body>\n               \n               </div>\n    }\n}\n\n\nexport default CalorieLogger;\n"]},"metadata":{},"sourceType":"module"}